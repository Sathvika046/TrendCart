<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Filter Page</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background-color: #f0f2f5;
}

.heading1 {
  background-color: rgba(0, 0, 255, 0.608);
  text-align: center;
  font-size: larger;
  color: #fff;
  font-weight: 700;
  padding: 10px 0;
}
.navmenu{
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 1.5rem;
  align-items: center;
}
nav.links {
  display: flex;
  justify-content: space-around;
  align-items: center;
  background-color: #f9f9f9;
  flex-wrap: wrap;
  padding: 10px 0;
}

.navlogo img {
  height: 80px;
  width: 120px;
  object-fit: cover;
}

.nav-link:hover,
.nav-link.active {
  background-color: #007bff;
  color: white;
}

.searchbar {
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid #ccc;
  padding: 6px 10px;
  border-radius: 12px;
  width: 50vw;
  max-width: 100%;
}

.searchbar select,
.searchbar input,
.searchbar button {
  border: none;
  outline: none;
  background: transparent;
}

.searchbar select {
  padding: 0 10px;
  font-size: large;
}

.searchbar input {
  flex: 1;
  padding: 10px;
  font-size: 16px;
}

.searchbar button {
  font-size: 18px;
  cursor: pointer;
}

.searchbar button i {
  color: #111;
}

.icons, .sign-icon, .cart-icon, .notify-icon {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 1.8rem;
}

.cart-icon {
  padding-top: 18px;
}

.cart-summary {
  font-size: 14px;
  margin-left: 10px;
  color: #333;
  font-weight: bold;
}

.hero-section {
  background: #f0f0ff;
  padding: 40px 20px;
  border-radius: 20px;
  margin: 40px auto;
  max-width: 1200px;
}

.hero-container {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 40px;
}

.hero-image img {
  max-width: 100%;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  width: 500px;
}

.hero-content {
  flex: 1;
  max-width: 600px;
}

.hero-content h1 {
  font-size: 40px;
  color: #5b4ecb;
  margin-bottom: 10px;
  font-weight: 800;
}

.hero-content .subtitle {
  font-size: 16px;
  color: #7a6be6;
  font-weight: 600;
  margin-bottom: 15px;
}

.hero-content .description {
  color: #555;
  font-size: 16px;
  margin-bottom: 20px;
}

h2#sectionHeading {
  padding: 20px;
  text-align: center;
  color: #5b4ecb;
  font-size: 30px;
  font-weight: 800;
}

.products {
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 380px;
}
.cart-item .remove-x {
  background: transparent;
  border: none;
  color: #c00;
  font-size: 18px;
  cursor: pointer;
  margin-left: 8px;
  transition: transform 0.25s ease-in-out, color 0.25s ease;
}
.cart-item .remove-x:hover {
   transform: scale(1.3) rotate(10deg);
  color: #f0f0ff;
  background-color: #ff0000;
}
.product-img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 5px;
  margin-bottom: 10px;
}
.card h3 {
  font-size: 18px;
  margin: 0 0 5px;
}
.card p {
  font-size: 14px;
  margin: 4px 0;
}
.cart-drawer {
  position: fixed;
  top: 0;
  right: -100%;
  width: 320px;
  height: 100%;
  background: white;
  box-shadow: -3px 0 8px rgba(0,0,0,0.2);
  z-index: 200;
  transition: right 0.3s ease;
  overflow-y: auto;
}

.cart-drawer.open {
  right: 0;
}

.cart-drawer-content {
  padding: 20px;
}

.close-cart {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
}

#cartItems {
  margin-top: 20px;
}

.cart-item {
  border-bottom: 1px solid #ccc;
  padding: 10px 0;
  display:flex;
  align-items:center;
  gap:10px;
}

.cart-item h4 {
  margin: 0 0 4px;
}

.cart-total {
  margin-top: 20px;
  font-weight: bold;
  font-size: 18px;
}

.btn {
  padding: 10px 20px;
  font-weight: bold;
  font-size: 14px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: 0.3s ease;
}

.btn.primary {
  background: linear-gradient(90deg, #5a60ea, #8d4fdc);
  color: white;
}

.btn.primary:hover {
  opacity: 0.9;
}

.btn.added {
  background-color: #28a745;
  color: white;
  cursor: not-allowed;
}

.signup {
  position: relative;
}

/* sign menu - slightly larger min-width so logout text fits */
.sign-menu {
  display: none;
  position: absolute;
  top: 50px;
  right: 0;
  background-color: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  border-radius: 5px;
  overflow: hidden;
  z-index: 10;
  font-size: 14px;
  font-weight: 600;
  min-width:220px;
}

.sign-menu div {
  padding: 10px 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
}

.sign-menu div:hover {
  background-color: #f0f0f0;
}

.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
  background-color: white;
  margin: 10% auto;
  padding: 30px;
  border-radius: 8px;
  width: 320px;
  position: relative;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.modal-content h2 {
  text-align: center;
  margin-bottom: 20px;
}

.modal-content input {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 5px;
  border: 1px solid #ccc;
}

.modal-content .btn {
  width: 100%;
}

.close {
  position: absolute;
  right: 15px;
  top: 10px;
  font-size: 20px;
  cursor: pointer;
}

.no-results {
  grid-column: 1 / -1;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 22px;
  font-weight: bold;
  color: #555;
  height: 200px;
  text-align: center;
}

.footer {
  background-color: black;
  padding: 40px 60px 20px;
  color: white;
}

.footer .footer-top {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 40px;
}

.footer-column h3 {
  margin-bottom: 15px;
}

.footer-column ul {
  list-style: none;
  padding: 0;
}

.footer-column ul li {
  margin-bottom: 10px;
  cursor: pointer;
}

.footer-column ul li:hover {
  text-decoration: underline;
}

.footer-bottom {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #ccc;
}

.footer-bottom .social-icons i {
  font-size: 22px;
  margin: 0 10px;
  color: #ccc;
  transition: 0.3s;
}

.footer-bottom .social-icons i:hover {
  color: #0073e6;
}

.footer-bottom p {
  margin: 10px 0;
  font-size: 14px;
  color: #777;
}

.hamburger {
  display: none;
  font-size: 24px;
  background: none;
  border: none;
  cursor: pointer;
}
img[loading="lazy"] {
opacity: 0;
transition: opacity 0.6s ease-in-out;
}

img.fade-in {
  opacity: 1;
}

@media (max-width: 660px) and (min-width:200px) {
  .navmenu {
    display: none;
    flex-direction: column;
    flex-wrap: wrap;
    gap: 10px;
    width: 100%;
    margin-top: 10px;
  }

  .navmenu.open {
    display: flex;
  }

  .hamburger {
    display: block;
    right: 20px;
    top: 20px;
  }

  .searchbar {
    width: 100%;
    box-sizing: border-box;
    padding: 5px;
  }
  .hero-container {
    flex-direction: column;
    text-align: center;
  }

  .footer .footer-top,
  .footer-bottom {
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
  }

  .products {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  }
}
.qty-controls {
  display:inline-flex;
  align-items:center;
  gap:8px;
  margin-top:6px;
}
.qty-controls button {
  width:28px;
  height:28px;
  border-radius:4px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
  font-size:16px;
  line-height:1;
}
.cart-item .price {
  margin-left:auto;
  font-weight:700;
}
.cart-item .remove-x {
  background:transparent;
  border:none;
  color:#c00;
  font-size:18px;
  cursor:pointer;
  margin-left:8px;
}
.signed-name {
  font-size: 12px;
  color: #555;
  margin-left: 8px;
  font-weight: 700;
  vertical-align: middle;
}

.pass-eye {
  position: relative;
}
.pass-eye .eye {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  color: #666;
}
  </style>
</head>
<body>
  <div class="heading1">Free delivery on order over ₹199</div>
  <nav class="links">
    <div class="navlogo">
      <img src="https://res.cloudinary.com/duracoq4p/image/upload/v1763371982/logo_zvpmml.png" alt="logo">
    </div>
    <button class="hamburger" onclick="document.querySelector('.navmenu').classList.toggle('open')">
      <i class="fa fa-bars"></i>
    </button>
    <div class="navmenu">
      <div class="search-wrapper">
        <div class="searchbar">
          <select id="categorySelect" onchange="searchProducts()">
            <option value="all">All</option>
            <option value="electronics">Electronics</option>
            <option value="clothing">Clothing</option>
            <option value="books">Books</option>
            <option value="Accessories">Accessories</option>
          </select>
          <input type="text" id="searchInput" placeholder="Search products" oninput="searchProducts()">
          <button onclick="searchProducts()"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
      </div>
      <div class="favs"><button class="icons"><i class="fa-regular fa-heart"></i></button></div>
      <div class="notify"><button class="notify-icon"><i class="fa-regular fa-bell"></i></button></div>
      <div class="signup">
        <!-- user button shows icon and will display small name when logged in -->
        <button id="signBtn" class="sign-icon" onclick="openAuthMenu(event)">
          <i class="fa-regular fa-circle-user"></i>
          <span id="signedName" class="signed-name" style="display:none;"></span>
        </button>
        <div id="signMenu" class="sign-menu" aria-hidden="true">
          <div id="signInBtn" onclick="openLoginModal()"><i class="fa-solid fa-right-to-bracket"></i> Sign In</div>
          <div id="registerBtn" onclick="openRegisterModal()"><i class="fa-solid fa-user-plus"></i> Register</div>
          <div id="logoutContainer" style="display:none;">
            <div id="logoutAction" onclick="signOut()" style="padding:10px 16px; cursor:pointer;">
              <i class="fa-solid fa-right-from-bracket"></i> Logout
            </div>
          </div>
        </div>
      </div>
      <div class="cart">
        <button class="cart-icon" onclick="toggleCartDrawer()"><i class="fa-solid fa-cart-shopping"></i></button>
        <div class="cart-summary" id="cartSummary">Cart: 0 items ($0)</div>
      </div>
    </div>
  </nav>

  <div id="cartDrawer" class="cart-drawer" aria-hidden="true">
    <div class="cart-drawer-content">
      <span class="close-cart" onclick="toggleCartDrawer()">&times;</span>
      <h2>Your Cart</h2>
      <div id="cartItems" aria-live="polite"></div>
      <div class="cart-total" id="cartTotal"></div>
      <button class="btn primary" id="buyNowBtn" onclick="buyNow()">Buy Now</button>
    </div>
  </div>

  <section class="hero-section">
    <div class="hero-container">
      <div class="hero-image">
        <img src="images/jessica-weiller-So4eFi-d1nc-unsplash.jpg" alt="Hero image">
      </div>
      <div class="hero-content">
        <h1>Trending</h1>
        <p class="subtitle">PERFORMANCE • INNOVATION • STYLE</p>
        <p class="description">Explore the latest in electronics, clothing, Accessories and books — all in one place.</p>
      </div>
    </div>
  </section>

  <h2 id="sectionHeading">All Categories</h2>
  <main class="products" id="productList"></main>

  <!-- Login Modal -->
  <div id="loginModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close" onclick="closeLoginModal()">&times;</span>
      <h2>Login</h2>
      <form id="loginForm">
        <input id="loginEmail" type="email" placeholder="Email" required />

        <div class="pass-eye" style="position:relative;">
          <input id="loginPassword" type="password" placeholder="Password" required />
          <i class="eye fa-solid fa-eye" onclick="togglePassword('loginPassword', this)" title="Show/Hide password"></i>
        </div>

        <button type="submit" class="btn primary">Login</button>
      </form>
      <p style="font-size:13px;color:#555;margin-top:8px;">Don't have an account? <a href="#" onclick="openRegisterModal(); return false;">Register</a></p>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close" onclick="closeRegisterModal()">&times;</span>
      <h2>Register</h2>
      <form id="registerForm">
        <input id="regName" type="text" placeholder="Full Name" required />
        <input id="regEmail" type="email" placeholder="Email" required />

        <div class="pass-eye" style="position:relative;">
          <input id="regPassword" type="password" placeholder="Password" required />
          <i class="eye fa-solid fa-eye" onclick="togglePassword('regPassword', this)" title="Show/Hide password"></i>
        </div>

        <button type="submit" class="btn primary">Send OTP & Register</button>

      </form>
      <p style="font-size:13px;color:#555;margin-top:8px;">Already has  an account? <a href="#" onclick="openLoginModal();closeRegisterModal(); return false;">Login</a></p>
      <div id="otpSection" style="display:none;margin-top:10px;">
        <p>Enter OTP sent to your email (simulated):</p>
        <input id="regOtp" type="text" placeholder="OTP" />
        <button id="confirmOtpBtn" class="btn primary">Confirm OTP</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-top">
      <div class="footer-column">
        <h3>Useful Links</h3>
        <ul>
          <li>Blog</li>
          <li>Privacy</li>
          <li>Terms</li>
          <li>FAQs</li>
          <li>Security</li>
          <li>Contact</li>
        </ul>
      </div>
      <div class="footer-column">
        <ul style="margin-top: 32px;">
          <li>Partner</li>
          <li>Franchise</li>
          <li>Seller</li>
          <li>Warehouse</li>
          <li>Deliver</li>
          <li>Resources</li>
        </ul>
      </div>
      <div class="social-icons">
        <i class="fab fa-facebook-f"></i>
        <i class="fab fa-twitter"></i>
        <i class="fab fa-instagram"></i>
        <i class="fab fa-linkedin-in"></i>
      </div>
    </div>
  </footer>

  <script>
// ---------- PRODUCTS (unchanged) ----------
const products = [
  { name: "Phone", category: "electronics", price: 500, rating: 4.5, image: "images/phone.jpg" },
  { name: "Laptop", category: "electronics", price: 1200, rating: 4.7, image: "images/laptop.webp" },
  { name: "SmartWatch", category: "electronics", price: 250, rating: 4.6, image: "images/Smartwatch.jpg" },
  { name: "Bluetooth Speaker", category: "electronics", price: 300, rating: 4.2, image: "images/bluetooth Speaker.webp" },
  { name: "Jeans", category: "clothing", price: 40, rating: 4.2, image: "images/jeans.jpg" },
  { name: "T-Shirt", category: "clothing", price: 25, rating: 4.0, image: "images/t-shirt.jpg" },
  { name: "Jacket", category: "clothing", price: 60, rating: 4.4, image: "images/jackect.webp" },
  { name: "Dress", category: "clothing", price: 90, rating: 4.3, image: "images/dress.jpeg" },
  { name: "King Series", category: "books", price: 15, rating: 4.8, image: "images/novel.jpg" },
  { name: "Twisted Series", category: "books", price: 5, rating: 4.1, image: "images/novel2.jpg" },
  { name: "Perfume", category: "Accessories", price: 250, rating: 4.6, image: "images/jessica-weiller-So4eFi-d1nc-unsplash.jpg" },
  { name: "Chain", category: "Accessories", price: 300, rating: 4.2, image: "images/chain.webp" },
  { name: "Suit", category: "Accessories", price: 430, rating: 4.2, image: "images/suit.jpeg" },
  { name: "Bracelet", category: "Accessories", price: 190, rating: 4.3, image: "images/bracelet.jpg" },
  { name: "Hairclip", category: "Accessories", price: 150, rating: 4.8, image: "images/hairclip.webp" },
  { name: "Sarees", category: "clothing", price: 340, rating: 4.2, image: "images/saree.jpeg" },
  { name: "Anarkali", category: "clothing", price: 290, rating: 4.3, image: "images/anarkali.webp" },
  { name: "Saree", category: "clothing", price: 159, rating: 4.8, image: "images/saree1.jpeg" },
];


let cart = JSON.parse(localStorage.getItem('cart_v1')) || [];

let users = JSON.parse(localStorage.getItem('users_v1')) || []; 
let session = JSON.parse(localStorage.getItem('session_v1')) || null; 

function saveUsers(){ localStorage.setItem('users_v1', JSON.stringify(users)); }
function saveSession(){ localStorage.setItem('session_v1', JSON.stringify(session)); }

function updateCartSummary(){
  const totalItems = cart.reduce((s,it)=>s + (it.quantity||0),0);
  const totalPrice = cart.reduce((s,it)=>s + it.price*(it.quantity||0),0);
  document.getElementById("cartSummary").textContent = `Cart: ${totalItems} items ($${totalPrice.toFixed(2)})`;
  document.getElementById("cartTotal").textContent = totalPrice>0 ? `Total: $${totalPrice.toFixed(2)}` : "";
}
function saveCart(){ localStorage.setItem('cart_v1', JSON.stringify(cart)); updateCartSummary(); }

function toggleCart(name){
  const idx = cart.findIndex(i=>i.name===name);
  if(idx===-1){
    const product = products.find(p=>p.name===name);
    if(!product) return;
    cart.push({...product, quantity:1});
  } else {
    cart.splice(idx,1);
  }
  saveCart();
  renderProducts(getCurrentFilteredProducts());
  renderCartItems();
}


function isInCart(productName){ return cart.some(i=>i.name===productName); }

function renderProducts(list){
  const container = document.getElementById("productList");
  container.innerHTML = "";
  if(!list || list.length===0){
    container.innerHTML = `<div class="no-results"><i class="fa-solid fa-magnifying-glass-location"></i> Item not found</div>`;
    return;
  }
  list.forEach(p=>{
    const inCart = isInCart(p.name);
    const buttonText = inCart ? "Remove from Cart" : "Add to Cart";
    const buttonClass = inCart ? "btn added" : "btn primary";
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.name}" class="product-img">
      <h3>${p.name}</h3>
      <p>Category: ${p.category}</p>
      <p>Price: $${p.price}</p>
      <p>Rating: ${p.rating}</p>
      <button class="${buttonClass}" onclick="toggleCart('${p.name}')">${buttonText}</button>
    `;
    container.appendChild(card);
  });
}


function getCurrentFilteredProducts(){
  const query = document.getElementById("searchInput").value.toLowerCase();
  const category = document.getElementById("categorySelect").value;
  return products.filter(product=>{
    const matchName = product.name.toLowerCase().includes(query);
    const matchCategory = category==='all' || product.category===category;
    return matchName && matchCategory;
  });
}
function searchProducts(){
  const category = document.getElementById("categorySelect").value;
  const title = category==='all' ? "All Products" : `Results in ${capitalize(category)}`;
  document.getElementById("sectionHeading").textContent = title;
  renderProducts(getCurrentFilteredProducts());
}
function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

//  CART DRAWER 
function renderCartItems(){
  const itemsContainer = document.getElementById("cartItems");
  itemsContainer.innerHTML = "";
  if(cart.length===0){
    itemsContainer.innerHTML = "<p>Your cart is empty.</p>";
    updateCartSummary();
    return;
  }
  cart.forEach(item=>{
    const row = document.createElement('div');
    row.className='cart-item';
    row.innerHTML = `
      <img src="${item.image}" alt="${item.name}" style="width:60px;height:60px;object-fit:cover;border-radius:6px;">
      <div style="flex:1;min-width:0;">
        <h4 style="margin:0 0 6px 0;">${item.name}</h4>
        <div>Price: $${item.price.toFixed(2)}</div>
        <div class="qty-controls" aria-label="Quantity controls">
          <button onclick="decreaseQty('${escapeQuotes(item.name)}')" aria-label="Decrease">-</button>
          <span id="qty-${safeId(item.name)}">${item.quantity}</span>
          <button onclick="increaseQty('${escapeQuotes(item.name)}')" aria-label="Increase">+</button>
          <button class="remove-x" title="Remove item" onclick="removeFromCart('${escapeQuotes(item.name)}')">&times;</button>
        </div>
      </div>
      <div class="price">$${(item.price*item.quantity).toFixed(2)}</div>
    `;
    itemsContainer.appendChild(row);
  });
  updateCartSummary();
}
function safeId(name){ return name.replace(/\s+/g,'_').replace(/[^\w\-]/g,''); }
function escapeQuotes(s){ return s.replace(/'/g,"\\'").replace(/"/g,'\\"'); }

function increaseQty(name){
  const idx = cart.findIndex(i=>i.name===name);
  if(idx===-1) return;
  cart[idx].quantity = (cart[idx].quantity||0)+1;
  saveCart();
  document.getElementById(`qty-${safeId(name)}`).textContent = cart[idx].quantity;
  renderCartItems();
  renderProducts(getCurrentFilteredProducts());
}
function decreaseQty(name){
  const idx = cart.findIndex(i=>i.name===name);
  if(idx===-1) return;
  if(cart[idx].quantity>1) cart[idx].quantity--;
  else cart.splice(idx,1);
  saveCart();
  renderCartItems();
  renderProducts(getCurrentFilteredProducts());
}
function removeFromCart(name){
  cart = cart.filter(i=>i.name!==name);
  saveCart();
  renderCartItems();
  renderProducts(getCurrentFilteredProducts());
}
function buyNow(){
  if(cart.length===0){ alert("Your cart is empty!"); return; }
  const total = cart.reduce((s,i)=>s + i.price*(i.quantity||0),0);
  alert(`Total amount: $${total.toFixed(2)}\nReady for payment.`);
  const buyButton = document.querySelector(".cart-drawer .btn.primary");
  if(buyButton){ buyButton.textContent="Order Placed"; buyButton.disabled=true; buyButton.classList.remove('primary'); buyButton.classList.add('added'); }
  cart = [];
  saveCart();
  renderProducts(getCurrentFilteredProducts());
  renderCartItems();
  setTimeout(()=>{ if(buyButton){ buyButton.textContent="Buy Now"; buyButton.disabled=false; buyButton.classList.add('primary'); buyButton.classList.remove('added'); } },5000);
}
function toggleCartDrawer(){
  const drawer = document.getElementById("cartDrawer");
  drawer.classList.toggle('open');
  drawer.setAttribute('aria-hidden', drawer.classList.contains('open') ? 'false' : 'true');
  renderCartItems();
}

function openAuthMenu(e){
  e.stopPropagation();
  const menu = document.getElementById('signMenu');
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}
function openLoginModal(){
  document.getElementById('signMenu').style.display = 'none';
  document.getElementById('loginModal').style.display = 'block';
  document.getElementById('loginModal').setAttribute('aria-hidden','false');
}
function closeLoginModal(){
  document.getElementById('loginModal').style.display = 'none';
  document.getElementById('loginModal').setAttribute('aria-hidden','true');
}
function openRegisterModal(){
  document.getElementById('signMenu').style.display = 'none';
  document.getElementById('registerModal').style.display = 'block';
  document.getElementById('registerModal').setAttribute('aria-hidden','false');
  document.getElementById('otpSection').style.display = 'none';
}
function closeRegisterModal(){
  document.getElementById('registerModal').style.display = 'none';
  document.getElementById('registerModal').setAttribute('aria-hidden','true');
}


function genOtp(){ return Math.floor(100000 + Math.random()*900000).toString(); }

// Simulate sending OTP - popup OTP on console.log only
function sendOtpToEmail(email, otp){
    alert("Check console for simulated OTP (in real app, it would be emailed).");
  console.log(`Simulated: OTP for ${email} => ${otp}`);
}

// Register form handling
let pendingOtp = null;
let pendingRegData = null;

document.getElementById('registerForm').addEventListener('submit', function(e){
  e.preventDefault();
  const name = document.getElementById('regName').value.trim();
  const email = document.getElementById('regEmail').value.trim().toLowerCase();
  const pwd = document.getElementById('regPassword').value;
  if(!name || !email || !pwd){ alert('All fields required'); return; }
  // check if already registered
  if(users.some(u=>u.email===email)){ alert('Email already registered. Please login.'); openLoginModal(); closeRegisterModal(); return; }
  pendingOtp = genOtp();
  pendingRegData = {name,email,password:pwd};
  sendOtpToEmail(email,pendingOtp);
  document.getElementById('otpSection').style.display = 'block';
});

// Confirm OTP
document.getElementById('confirmOtpBtn').addEventListener('click', function(){
  const entered = document.getElementById('regOtp').value.trim();
  if(!entered){ alert('Enter OTP'); return; }
  if(entered === pendingOtp){
    users.push({...pendingRegData});
    saveUsers();
    alert('Registration successful. Please login now.');
    pendingOtp = null;
    pendingRegData = null;
    document.getElementById('registerForm').reset();
    document.getElementById('otpSection').style.display = 'none';
    closeRegisterModal();
    openLoginModal();
  } else {
    alert('OTP incorrect. Check console and try again.');
  }
});

function togglePassword(id, icon){
  const field = document.getElementById(id);
  if(!field) return;
  if(field.type === 'password'){
    field.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    field.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}

// Login handling
document.getElementById('loginForm').addEventListener('submit', function(e){
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim().toLowerCase();
  const pwd = document.getElementById('loginPassword').value;
  const user = users.find(u=>u.email===email && u.password===pwd);
  if(!user){ alert('Invalid credentials.'); return; }
  session = {email:user.email, name:user.name};
  saveSession();
  closeLoginModal();
  applyLoggedInUI();
  alert('Logged in successfully');
});

function applyLoggedInUI(){
  const signInEl = document.getElementById('signInBtn');
  const registerEl = document.getElementById('registerBtn');
  const logoutContainer = document.getElementById('logoutContainer');
  const signedNameEl = document.getElementById('signedName');
  const signBtn = document.getElementById('signBtn');

  if(session && session.name){
    signedNameEl.style.display = 'inline-block';
    signedNameEl.textContent = session.name.split(' ')[0]; // first name abbreviated
    signInEl.style.display = 'none';
    registerEl.style.display = 'none';
    logoutContainer.style.display = 'block';
  } else {
    signedNameEl.style.display = 'none';
    signedNameEl.textContent = '';
    signInEl.style.display = 'block';
    registerEl.style.display = 'block';
    logoutContainer.style.display = 'none';
  }
  saveSession();
}

function signOut(){
  session = null;
  saveSession();
  applyLoggedInUI();
  alert('Signed out');
  document.getElementById('signMenu').style.display = 'none';
}

window.addEventListener('click', function(e){
  if(!e.target.closest('.signup') && !e.target.closest('#signMenu')){
    const m = document.getElementById('signMenu'); if(m) m.style.display = 'none';
  }
  if(e.target.id === 'loginModal') closeLoginModal();
});

renderProducts(products);
renderCartItems();
updateCartSummary();

try {
  const storedSession = JSON.parse(localStorage.getItem('session_v1'));
  if(storedSession && storedSession.name){
    session = storedSession;
  }
} catch(err){  }
applyLoggedInUI();

document.getElementById('searchInput').addEventListener('input', searchProducts);
document.getElementById('categorySelect').addEventListener('change', searchProducts);

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('img').forEach(img => {
    img.addEventListener('load', () => img.classList.add('fade-in'));
  });
});
  </script>
</body>
</html>
